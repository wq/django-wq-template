{% if with_npm %}
init:
    css: public/css
{% else %}
optimize:
    appDir: .
    baseUrl: js/lib
    dir: ../htdocs-build
    skipDirOptimize: true
    removeCombined: true
    modules:
         -
            name: "{{ project_name }}"
    paths:
        {{ project_name }}: "../{{ project_name }}"
        data: ../data
{% endif %}
# Generate JSON fixtures
collectjson:
     # Mustache Templates
     -
        paths:
             - ../templates
        type: html
        output: {% if with_npm %}src/tmpdata/templates.json{% else %}js/data/templates.js{% endif %}
        json:
            indent: 4
        {% if not with_npm %}jsonp: define{% endif %}

# Compile jQuery Mobile themes from SCSS
scss:
    indir: scss
    outdir: {% if with_npm %}public/{% endif %}css

# Update version.txt & JS module
setversion:
    filename: ../version.txt
    {% if not with_npm %}jsout: js/data/version.js {% endif %}

# Generate web icons
icons:
    source: {% if with_npm %}public/{% endif %}icon-1024.png
    {% if with_npm %}outdir: public/{% endif %}
    filename: icon-{size}.png
    size: web
{% if not with_npm %}
# Generate Application Cache manifest
appcache:
    name: "{{ project_name }}.appcache"
    css: "css/{{ project_name }}.css"
    css-ignore: "css/lib/images/icons-png/.*"
    cache:
         - js/lib/require.js
         - css/lib/images/marker-icon.png
         - css/lib/images/marker-icon-2x.png
         - css/lib/images/marker-shadow.png
    network:
         - "*"
         - "http://*"
         - "https://*"
    fallback: []
{% endif %}
{% if with_pgb %}
# Compile with PhoneGap Build
phonegap:
   source: {% if with_npm %}build/{% else %}../htdocs/{% endif %}
   pgb_directory: ../.wq-pgb
   config_xml: pgb/config.xml
   index_html: pgb/index-phonegap.html
   icon: {% if with_npm %}public/{% endif %}icon-1024.png
{% endif %}
